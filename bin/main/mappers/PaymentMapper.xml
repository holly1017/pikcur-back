<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pikcurchu.pikcur.mapper.PaymentMapper">
    <insert id="insertPayment">
        insert into payment(payment_id, transaction_id, payment_method, payment_price)
        values(#{paymentId}, #{transactionId}, #{paymentMethod}, #{paymentPrice});
    </insert>

    <select id="selectPaymentAddress" parameterType="map" resultType="com.pikcurchu.pikcur.dto.response.ResPaymentAddressDto">
        SELECT
            (b.bid_price + g.shipping_price) AS payPrice,
            a.name AS receiver,
            a.phone,
            a.address,
            a.address_detail AS addressDetail
        FROM
            bid b
        JOIN
            goods g
        ON g.goods_id = b.goods_id
        LEFT JOIN
            address a
        ON  a.member_no = b.member_no
        AND a.is_default = 'Y'
        WHERE
            b.bid_id = #{bidId}
        AND b.member_no = #{memberNo}
        AND b.status_no = '03';
    </select>

    <select id="selectBuyoutPaymentAddress" resultType="com.pikcurchu.pikcur.dto.response.ResPaymentAddressDto">
        SELECT
        (g.buyout_price + g.shipping_price) AS payPrice,
        a.name AS receiver,
        a.phone,
        a.address,
        a.address_detail AS addressDetail
        FROM
        goods g
        LEFT JOIN
        address a
        ON  a.member_no = #{memberNo}
        where
        a.is_default = 'Y'
        AND a.member_no = #{memberNo}
        and g.goods_id=#{goodsId}
    </select>
</mapper>