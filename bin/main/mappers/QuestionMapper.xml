<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pikcurchu.pikcur.mapper.QuestionMapper">
    <insert id="insertQuestion" useGeneratedKeys="true" keyProperty="questionId" parameterType="com.pikcurchu.pikcur.dto.request.ReqQuestionDto">
        insert into question(goods_id, member_no, title, content, is_public)
        values (#{goodsId}, #{memberNo}, #{title}, #{content}, #{isPublic})
    </insert>
    <update id="updateQuestionImagePath">
        update question set image = #{uploadedPath} where question_id = #{questionId}
    </update>
    <insert id="insertAnswer" useGeneratedKeys="true" keyProperty="answerId" parameterType="com.pikcurchu.pikcur.dto.request.ReqAnswerDto">
        insert into answer(question_id, member_no, title, content)
        values (#{questionId}, #{memberNo}, #{title}, #{content})
    </insert>
    <update id="updateAnswerImagePath">
        update answer set image = #{uploadedPath} where answer_id = #{answerId}
    </update>
    <select id="findQuestionDetailById" resultMap="questionDetailResultMap">
        select
        q.question_id,
        q.member_no,
        g.store_id,
        q.title,
        q.content,
        q.image as image_path,

        a.answer_id,
        a.title as ans_title,
        a.content as ans_content,
        a.image as ans_image_path
        from question q
        left join
        answer a ON a.question_id = q.question_id
        join
        goods g ON g.goods_id = q.goods_id
        where q.question_id = #{questionId};
    </select>
    <resultMap id="questionDetailResultMap" type="com.pikcurchu.pikcur.dto.response.ResQuestionDetailDto">
        <id property="questionId" column="question_id" />
        <result property="memberNo" column="member_no" />
        <result property="storeId" column="store_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="imagePath" column="image_path" />

        <association property="answerInfo" javaType="com.pikcurchu.pikcur.dto.response.AnswerInfo">
            <result property="answerId" column="answer_id"/>
            <result property="title" column="ans_title"/>
            <result property="content" column="ans_content"/>
            <result property="imagePath" column="ans_image_path"/>
        </association>
    </resultMap>
</mapper>